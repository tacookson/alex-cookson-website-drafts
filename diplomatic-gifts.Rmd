---
title: "What do countries' diplomatic gifts tell us about them?"
description: "Text analysis of diplomatic gifts to U.S. federal employees"
author: "Alex Cookson"
date: "2020-05-09"
output: html_document
---  
\  

Introduction text.

Question we are asking: Do countries tend to give certain types of gifts? For example, would a typical gift from Canada be something related to hockey, maple syrup, or polar bears?


## Setup

First, we'll load the `tidyverse` and some other useful packages:

- `tidytext` for text analysis (Julia Silge and David Robinson wrote an [excellent book](https://www.tidytextmining.com/) on text analysis using this package)
- `fishualize` for beautiful ggplot2 colour palettes
- `extrafont` for additional fonts
- `ggtext` for rich-text customization of text (e.g., changing colours of individual words)  
\  

Then we'll import our data, which comes originally from the [U.S. Office of the Federal Register](https://www.archives.gov/federal-register), which provides access to federal government documents, including the reports of diplomatic gifts that we're looking for. The original documents needed extensive parsing and cleaning to get them into a [tidy format](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html). I won't go into detail on that process here, but if you're interested in the cleaning process or want to learn more about the data itself, look at the [README](https://github.com/tacookson/data/tree/master/us-government-gifts) on GitHub.

```{r setup-and-import, warning = FALSE, message = FALSE}
library(tidyverse)
library(tidytext)
library(fishualize)
library(extrafont)
library(ggtext)

theme_set(theme_light())

gifts <- read_csv("https://raw.githubusercontent.com/tacookson/data/master/us-government-gifts/gifts.csv")
```  
\  


## Data inspection

Let's see what the `gifts` dataset has for us!

```{r inspect-data}
# glimpse bottom of data because top doesn't have good examples
glimpse(gifts %>% arrange(-id)) %>% View()
```

There are four types of data:

1. Who **received** the gift, including name/title and what agency they are associated with
2. Who **gave** the gift, including name/title and the country they represent
3. Details on the **gift itself**, mostly in the written `gift_description`, but also in the `value_usd` field, which gives the estimated value
4. Details about the `occasion of gifting`, like when it was received and the reason the gift was accepted  
\  

We'll focus on the `gift_description` field, which has *wonderful* free-form text descriptions. I spent *hours* reading some of these descriptions. Here is a short example of a gift given in 2003 to First Lady Laura Bush by French President Jacques Chirac.

```{r example-gift-description}
gifts %>%
  filter(id == 1605) %>%
  pull(gift_description)
```

(We'll soon see from our analysis that *Herm√®s* items are a quintessentially French gift.)  
\  


## Text analysis with TF-IDF

Explanation of steps in text analysis and what TF-IDF is

### Tokenizing and eliminating stop words

```{r gift-tokens-with-stop-words}
gift_words_raw <- gifts %>%
  # Select unique gift descriptions to pare down gifts that often take up multiple lines
  distinct(gift_description, .keep_all = TRUE) %>%
  transmute(id,
            donor_country,
            gift_description = str_to_lower(gift_description)) %>%
  # Filter out travel
  filter(!str_detect(gift_description, "travel")) %>%
  # Break gift_description into individual words
  unnest_tokens(word, gift_description)
```

Review tokenized gift words and explain why we need stop words


```{r stop-words}
# Country stop words
source("https://raw.githubusercontent.com/tacookson/data/master/us-government-gifts/src/country-adjective-list.R")

# Stop words specific to this dataset
gift_stop_words <- c("x", # Used for describing dimensions
                     "inches",
                     "est", # Common words about value and disposition
                     "rec'd",
                     "recd",
                     "disposition",
                     "administration",
                     "services",
                     "pending",
                     "transfer",
                     "transferred",
                     "archives",
                     "protocol",
                     "gsa",
                     "national",
                     "foreign",
                     "records",
                     "de", # Stop word in romance languages like French/Spanish
                     "la",
                     "los")

# Month name stop words
month_stop_words <- str_to_lower(c(month.abb, month.name))

# Put all the stop words together
custom_stop_words <- tibble(stop_word = c(country_stop_words,
                                          gift_stop_words,
                                          month_stop_words)) %>%
  unnest_tokens(word, stop_word)
```

```{r gift-words-cleaned}
gift_words <- gift_words_raw %>%
  # Get rid of standard English stop words (or, the, an, etc.)
  anti_join(stop_words, by = "word") %>%
  # Get rid of our custom stop words
  anti_join(custom_stop_words, by = "word") %>%
  # Only keep words that have at least one letter
  # Numbers only aren't likely meaningful in our context
  filter(str_detect(word, "[a-z]"),
         !is.na(donor_country))
```


### Calculating TF-IDF

Decision to require that gifts be given at least 3 times

```{r tf-idf}
gift_words_tfidf <- gift_words %>%
  distinct(id, donor_country, word) %>%
  count(word, donor_country) %>%
  bind_tf_idf(word, donor_country, n) %>%
  # Only include words that appears in at least 3 gift descriptions
  filter(n >= 3)
```

```{r}
gift_words_tfidf %>%
  filter(donor_country == "Kenya") %>%
  arrange(desc(tf_idf))
```



### Overall top words

Explanation of `ggtext`? Or just use it?

```{r top-tf-idf-overall}
# Set defaults for annotations so we don't need to copy-paste them
# fill = "white" doesn't work for some reason
update_geom_defaults(GeomRichtext, list(hjust = 0, colour = "grey20", label.colour = NA,
                                        family = "Bahnschrift", size = 4))

gift_words_tfidf %>%
  top_n(16, wt = tf_idf) %>%
  mutate(word = fct_reorder(str_to_title(word), tf_idf)) %>%
  ggplot(aes(tf_idf, word, fill = donor_country)) +
  geom_col() +
  geom_text(aes(label = donor_country),
            col = "white",
            fontface = "bold",
            hjust = 1,
            nudge_x = -0.005) +
  # Iceland
  geom_richtext(x = 0.307, y = 13.5, fill = "white",
                label = "Iceland often gifts the book set<br>\"The <span style = 'color:#669638'>**Complete Sagas**</span> of <span style = 'color:#669638'>**Icelanders**</span>\"") +
  # Marshall Islands
  geom_richtext(x = 0.248, y = 10.5, fill = "white",
                label = "Marshall Islands gifted many <span style = 'color:#BCA51F'>**elephant tusks**</span><br>in 2001, which were purposefully <span style = 'color:#BCA51F'>**destroyed**</span>") +
  # Sweden
  geom_richtext(x = 0.202, y = 9, fill = "white",
                label = "Sweden gifts <span style = 'color:#F0A630'>**Orrefors**</span> crystal") +
  # Ghana
  geom_richtext(x = 0.161, y = 7, hjust = 0, fill = "white",
                label = "Ghana gifts <span style = 'color:#92B7B7'>**Kente**</span>, a traditional Ghanian fabric") +
  # Cuba
  geom_richtext(x = 0.138, y = 1, hjust = 0, fill = "white",
                label = "Cuba, naturally, gifts <span style = 'color:#99AFD6'>**cigars**</span>") +
  scale_fill_fish("Epibulus_insidiator", discrete = TRUE) +
  scale_colour_fish("Epibulus_insidiator", discrete = TRUE) +
  expand_limits(x = c(0, 0.5)) +
  labs(title = "What are the most \"distinctive\" words associated with diplomatic gifts?",
       x = "TF-IDF",
       y = NULL) +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Bahnschrift"),
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(),
        axis.text.y = element_text(size = 14),
        strip.background = element_blank(),
        strip.text = element_text(colour = "black", face = "bold"))
```

Annotation notes for above:

- Iceland likes giving the book set "The Complete Sagas of Icelanders" (id 762, 7026, 7790)
- Luxembourg likes giving fox sculptures (id 2123, 2239, 2678)
- Ghana likes giving Kente cloth gifts, which is a traditional cloth of Ghana (id 880, 2527, 8361)
- Moldova likes giving cognac (id 5932, 8293)
- Cuba likes giving cigars (id 568, 7152, 6959)
- Sweden likes giving Orrefors crystal (id 654, 1742, 6195)


### Specific countries

```{r interesting-countries}
g7_countries <- c("Italy", "Japan", "Germany", "Canada", "United Kingdom", "France")

g20_countries <- c("Argentina", "Australia", "Brazil", "Canada", "China", "France", "Germany",
                   "India", "Indonesia", "Italy", "Japan", "Mexico", "Russia", "Saudi Arabia",
                   "South Africa", "South Korea", "Turkey", "United Kingdom")
```

```{r g7-countries-tf-idf}
gift_words_tfidf %>%
  filter(donor_country %in% g7_countries) %>%
  group_by(donor_country) %>%
  top_n(6) %>%
  ungroup() %>%
  mutate(word = reorder_within(word, by = tf_idf, within = donor_country, sep = ": ")) %>%
  ggplot(aes(tf_idf, word, fill = donor_country)) +
  geom_col() +
  scale_y_reordered(sep = ": ") +
  scale_fill_fish(option = "Epibulus_insidiator", discrete = TRUE) +
  facet_wrap(~ donor_country, scales = "free_y") +
  labs(title = "What words are associated with countries' gifts to the U.S.?") +
  theme(legend.position = "none",
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(),
        axis.text.y = element_text(size = 14),
        strip.background = element_blank(),
        strip.text = element_text(colour = "black", face = "bold"))
```

```{r g20-countries-tf-idf}
gift_words_tfidf %>%
  filter(donor_country %in% setdiff(g20_countries, g7_countries)) %>%
  group_by(donor_country) %>%
  top_n(6) %>%
  ungroup() %>%
  mutate(word = reorder_within(word, by = tf_idf, within = donor_country, sep = ": ")) %>%
  ggplot(aes(tf_idf, word, fill = donor_country)) +
  geom_col() +
  scale_y_reordered(sep = ": ") +
  scale_fill_fish(option = "Epibulus_insidiator", discrete = TRUE) +
  facet_wrap(~ donor_country, scales = "free_y") +
  labs(title = "What words are associated with different countries' diplomatic gifts to the U.S.?") +
  theme(legend.position = "none",
        panel.grid.minor = element_blank(),
        panel.grid.major.y = element_blank(),
        axis.text.y = element_text(size = 14),
        strip.background = element_blank(),
        strip.text = element_text(colour = "black", face = "bold"))
```


### Drawbacks of TF-IDF

Discuss shortcoming of TF-IDF approach:

- You might get words that aren't meaningful to answering your question (e.g., Moscow, Kremlin for Russia)
- Tokenizing by individual words ignores significance of compound nouns (e.g., mother-of-pearl for South Korea, leather briefcase for Argentina)
- Words used in one or two "documents" can have large TF-IDF, which can be misleading. We filtered for words that appear in at least three gift descriptions to address this, but adding that filter has its own issues because we set an arbitrary threshold and might be losing out on interesting information in words that do appear in only 1 or 2 descriptions.


## Conclusion

Conclusion goes here!



### Appendix

Questions:

- What are the most and least expensive gifts?
- Do some countries give more expensive gifts than others?
- How many of these gifts are given specifically to the President? (And what is their value?)
- What gifts has Canada given?
- Do certain countries give certain types of gifts?


Additional areas to explore:

- Looking at named entities instead of single words (would probably capture things like "men's watch" instead of separating the words)
- Stemming or lemmatization of words (e.g., Kenya had different words for "elephant" and "elephants". Those aren't really different concepts, so it would make sense to combine them into one word)
- Are there are regional patterns to gifts? (e.g., are Middle Eastern countries more likely to gift rugs than other countries?)


```{r gift-description-lookup}
gifts %>%
  filter(donor_country == "Marshall Islands",
         str_detect(str_to_lower(gift_description), "destroyed")) %>%
  View()
```