---
title: Analyzing Himalayan climbing expeditions
author: Alex Cookson
date: '2020-03-22'
slug: analyzing-himalayan-climbing-expeditions
categories: []
tags: []
description: ''
topics: []
---  
\  

Introduction


## Setup

First, we'll load the `tidyverse` and import our data.

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(fishualize) # Cool colour palettes
library(glue)
library(scales)

theme_set(theme_light())

peaks <- readr::read_csv("https://raw.githubusercontent.com/tacookson/data/master/himalayan-expeditions/peaks.csv")
expeditions <- readr::read_csv("https://raw.githubusercontent.com/tacookson/data/master/himalayan-expeditions/expeditions.csv")
members <- readr::read_csv("https://raw.githubusercontent.com/tacookson/data/master/himalayan-expeditions/members.csv")
```  
\  


## Data inspection

How high are these peaks?

```{r}
peaks %>%
  ggplot(aes(height_metres)) +
  geom_histogram(binwidth = 100)
```

How many are climbed vs. not?

```{r}
peaks %>%
  count(climbing_status)
```

What is different from the climbed and unclimbed peaks? Are unclimbed peaks higher?

Showcase the `varwdith` argument of geom_boxplot and how to get the N in the axis label

```{r}
climbed_labels <- glue("{levels(as.factor(peaks$climbing_status))}\nN = {table(peaks$climbing_status)}")

peaks %>%
  ggplot(aes(climbing_status, height_metres, fill = climbing_status)) +
  geom_boxplot(alpha = 0.5,
               varwidth = TRUE) +
  scale_fill_fish(option = "Pseudocheilinus_tetrataenia",
                  discrete = TRUE) +
  scale_x_discrete(labels = climbed_labels) +
  scale_y_continuous(labels = comma_format()) +
  labs(title = "Height and Climbing status of Himalayan Peaks",
       x = "",
       y = "Peak height (metres)",
       fill = "") +
  theme(legend.position = "none")
```

Fix first ascent year for Sharpu II (code SPH2)

```{r}
peaks_fixed <- peaks %>%
  mutate(first_ascent_year = ifelse(peak_id == "SPH2", 2018, first_ascent_year))
```

Visualize distribution of first ascent years

```{r}
peaks_fixed %>%
  ggplot(aes(first_ascent_year)) +
  geom_histogram(binwidth = 5)
```

What peaks were first summited before 1950

```{r}
peaks_fixed %>%
  filter(first_ascent_year < 1960) %>%
  arrange(first_ascent_year) %>%
  View()
```

Count countries associated with first ascents

Collapsed "W Germany" into "Germany"

```{r}
peaks_fixed %>%
  filter(!is.na(first_ascent_country)) %>%
  separate_rows(first_ascent_country, sep = ",") %>%
  mutate(
    first_ascent_country = str_squish(first_ascent_country),
    first_ascent_country = ifelse(
      first_ascent_country == "W Germany",
      "Germany",
      first_ascent_country
    )
  ) %>%
  count(first_ascent_country, name = "first_ascents", sort = TRUE) %>%
  mutate(first_ascent_country = fct_reorder(first_ascent_country, first_ascents)) %>%
  top_n(20, wt = first_ascents) %>%
  ggplot(aes(first_ascents, first_ascent_country, fill = first_ascent_country)) +
  geom_col() +
  scale_fill_fish(option = "Pseudocheilinus_tetrataenia",
                  discrete = TRUE) +
  labs(title = "Countries with the most first ascents of Himalayan peaks",
       x = "Number of first ascents",
       y = "") +
  theme(legend.position = "none")
```

Have the countries involved in first ascents changed over time?

```{r}
peaks_fixed %>%
  filter(!is.na(first_ascent_country),
         first_ascent_year >= 1910) %>%
  separate_rows(first_ascent_country, sep = ",") %>%
  mutate(
    first_ascent_country = str_squish(first_ascent_country),
    first_ascent_country = ifelse(
      first_ascent_country == "W Germany",
      "Germany",
      first_ascent_country
    ),
    first_ascent_decade = first_ascent_year %/% 10 * 10,
    first_ascent_country = fct_lump(first_ascent_country, 8)
  ) %>%
  count(first_ascent_country,
        first_ascent_decade,
        name = "first_ascents") %>%
  group_by(first_ascent_decade) %>%
  mutate(pct_of_ascents = first_ascents / sum(first_ascents)) %>%
  ungroup() %>%
  mutate(
    first_ascent_country = fct_reorder(first_ascent_country, -first_ascents, sum),
    first_ascent_country = fct_relevel(first_ascent_country, "Other", after = Inf)
  ) %>%
  ggplot(aes(first_ascent_decade, pct_of_ascents, fill = first_ascent_country)) +
  geom_col() +
  scale_x_continuous(breaks = seq(1930, 2010, 10)) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  scale_fill_fish(option = "Pseudocheilinus_tetrataenia",
                  discrete = TRUE) +
  facet_wrap( ~ first_ascent_country) +
  labs(title = "Percent of first ascents involving an expedition member from this country") +
  theme(legend.position = "none",
        panel.grid.minor = element_blank())
```






## Appendix

### Preliminary Questions

Peaks:

- How tall are Himalayan peaks?
- When were they first climbed?
- What countries were involved in first ascents?


Expeditions:

- What peaks were the most popular to climb?
- How big are expeditions?
- How many people are typically hired?
- What are the success rates of expeditions?
- Why do expeditions fail?
- What is the threat rate for injuries and deaths?
- Are there any particularly dangerous peaks?
- What proportion of expeditions use oxygen?


Members:

- What's the typical composition of expedition members? Age, sex, citizenship?
- Are any particular mountains more popular with certain countries?
- Are there any particularly dangerous expedition roles
- What types of injuries and causes of death are there?
- Are there any particularly dangerous elevations?
- Are younger climbers more likely to attempt solo climbs or not use oxygen?
